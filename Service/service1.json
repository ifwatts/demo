{
  "service": {
    "specVersion": "v3",
    "catalog_metadata": {
      "name": "Single vm",
      "description": "deploys a single VM to the chosen cloud",
      "image": "serviceicon_1.svg",
      "category": "Think Demos",
      "bullets": [],
      "providerDisplayName": "IBM",
      "longDescription": "deploys a single VM to the chosen cloud\n- shows usage of conditions and plans to highlight the composer's ability to link and flow tasks",
      "documentationUrl": "",
      "supportUrl": "",
      "bindable": false,
      "updatable": "",
      "systemTags": true,
      "author": "admin"
    },
    "tags": [
      {
        "name": "Request_Group",
        "label": "Request_Group",
        "type": "string",
        "immutable": true,
        "hidden": false,
        "required": false,
        "secured": false,
        "description": "The current context group id of the current user that requested the provisioning of the template. This is important because a user may be part of more than one group and this identifies the context of which group the user made the request.",
        "isSystemTag": true,
        "default": "${svc_instance.group}",
        "customtype": "string",
        "permission": "Read-Only"
      },
      {
        "name": "Request_User",
        "label": "Request_User",
        "type": "string",
        "immutable": true,
        "hidden": false,
        "required": false,
        "secured": false,
        "description": "The user id of the current user that requested the provisioning of the template.",
        "isSystemTag": true,
        "default": "${svc_instance.owner}",
        "customtype": "string",
        "permission": "Read-Only"
      },
      {
        "name": "Service_Name",
        "label": "Service_Name",
        "type": "string",
        "immutable": true,
        "hidden": false,
        "required": false,
        "secured": false,
        "description": "Name provided for the service instance by the end user at time of request",
        "isSystemTag": true,
        "default": "${svc_instance.name}",
        "customtype": "string",
        "permission": "Read-Only"
      },
      {
        "name": "Service_Identifier",
        "label": "Service_Identifier",
        "type": "string",
        "immutable": true,
        "hidden": false,
        "required": false,
        "secured": false,
        "description": "Unique identifer generated by ICAM which is mapped to the service instance of the template provisioned.",
        "isSystemTag": true,
        "default": "${svc_instance.service_instance_id}",
        "customtype": "string",
        "permission": "Read-Only"
      }
    ],
    "actions": [
      {
        "type": "provision",
        "name": "Provision",
        "description": "Default action for deployment of service",
        "input_parameters": [
          {
            "name": "aws_access_key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": false,
            "secured": false,
            "default": "^(dGVtcA==)"
          },
          {
            "name": "aws_secret_key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": false,
            "secured": false,
            "default": "^(dGVzdA==)"
          },
          {
            "name": "cloud",
            "label": "cloud",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "cloud to deploy to",
            "options": [
              {
                "label": "IBM",
                "value": "IBM",
                "default": false
              },
              {
                "label": "AWS",
                "value": "AWS",
                "default": false
              },
              {
                "label": "Azure",
                "value": "Azure",
                "default": false
              },
              {
                "label": "Google",
                "value": "Google",
                "default": false
              }
            ]
          },
          {
            "name": "user_email",
            "label": "Your email addres",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": false,
            "secured": false,
            "description": "Your email address to allow the system to send you information about your deployment when completed",
            "default": "ifwatts@ca.ibm.com"
          },
          {
            "name": "public_key",
            "label": "Public Key",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": true,
            "description": "public key needed to connect to the vm post deployment",
            "default": "^(c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFDNlJwTFpSdWluZXcrRTREWU1zR294dnQzVWhRQnloZWtzc2NqWVRmR1NkaGk5TmZtVmlIVmV4TUNNSlJwMmJwK0NRekhiNmtORmhDRURqUTNTMnVOa29qSEdmMXFWZndwb1BWTG5GN2tEdDJqcXpjK0k3dGV4Uy9JTnZ4WEdGd2krMmo4SHlHc2FxRTZNY1V2Tkt2Q0FWMys1OXhUcGdkYS9oQW80Tk0vNjhJUmxBd0ZQdzJncWNWaVBlVUhYZlV3aXFUc05hdUdObFNFNEVQWE8xT2E5MjZNSXc0OCtXb3RWV0xkcnMvT0dYcmhNSVM1ajFIS2NZUTcrd0pFMHZONElYbFk5K0twd0RKdEJKRHk4MW03bmpSaU52TVBwS0lPTExwSUcvd3BzMVlPdkttOVBRbVJxVWFUVXBab09YWWVLclE2THBxLzYrSk9abWdzQ0dCVFogaWZ3YXR0c0BjYS5pYm0uY29tQGlhbnMtbWJwLndhci5jYW4uaWJtLmNvbQ==)"
          },
          {
            "name": "cam_pwd",
            "label": "Password for camuser",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": true,
            "description": "password used for the camuser on the system",
            "default": "^(VGhpbms0bWUyMg==)"
          },
          {
            "name": "admin_pwd",
            "label": "Admin Password",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": true,
            "description": "password for the admin user",
            "default": "^(VGhpbms0bWUyISE=)"
          },
          {
            "name": "mariadb_pwd",
            "label": "MariaDB Password",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": true,
            "description": "password for the mariadb instance",
            "default": "^(VGhpbms0bWUyISE=)"
          },
          {
            "name": "gce_ssh_pub_key",
            "label": "Google SSH Pub Key",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": true,
            "description": "public ssh key for Google cloud",
            "default": "^(Z3NkZmdzZGZnZmRzZ2Zkc2c=)"
          },
          {
            "name": "gce_ssh_pri_key",
            "label": "Google Private SSH Key",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": true,
            "default": "^(c2RmZ3NmZGdzZGc=)"
          },
          {
            "name": "inst_name",
            "label": "Instance Name",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Name of the instance in the cloud provider",
            "default": "demo_inst1"
          },
          {
            "name": "lamp_prefix",
            "label": "Lamp Stack name prefix",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "the prefix of the lamp stack instances (must be globally unique)",
            "default": "lamp2"
          }
        ],
        "flow": {
          "conditions": [
            {
              "decision": {
                "title": "Cloud",
                "options": [
                  {
                    "case": "IBM",
                    "sequence": {
                      "0": "lampstac1273cd6e"
                    }
                  },
                  {
                    "case": "AWS",
                    "sequence": {
                      "0": "lampstacbd61e316"
                    }
                  },
                  {
                    "case": "Azure",
                    "sequence": {
                      "0": "lampstac86b071eb"
                    }
                  },
                  {
                    "case": "Google",
                    "sequence": {
                      "0": "googlecl6518f381"
                    }
                  }
                ],
                "id": "decision4441041f",
                "mapped_parameter": "${input_parameters.cloud}"
              }
            }
          ],
          "templates": [
            {
              "LAMP stack deployment (hybrid-cloud)": {
                "title": "LAMP stack deployment (hybrid-cloud)_881b97",
                "template_name": "LAMP stack deployment (hybrid-cloud)",
                "version": "2.2",
                "id": "lampstac1273cd6e",
                "template_type": "Terraform",
                "template_content_type": "IBM",
                "template_provider": "IBM",
                "instance_name": "${input_parameters.inst_name}",
                "cloud_connection_name": "IBM",
                "template_data_objects": {
                  "bastionhost": "DefaultNoBastionHostRequired"
                },
                "template_params": {
                  "softlayer_datacenter": "ams01",
                  "aws_access_key": "${input_parameters.aws_access_key}",
                  "aws_secret_key": "${input_parameters.aws_secret_key}",
                  "aws_region": "us-east-1",
                  "php_instance_name": "lampPhp",
                  "db_instance_name": "lampDb",
                  "network_name_prefix": "opencontent-lamp-hybrid",
                  "public_key_name": "cam-public-key-lamp-hybrid",
                  "public_key": "${input_parameters.public_key}",
                  "cam_user": "camuser",
                  "cam_pwd": "${input_parameters.cam_pwd}"
                },
                "outputs": []
              }
            },
            {
              "LAMP stack deployment": {
                "title": "LAMP stack deployment_728516",
                "template_name": "LAMP stack deployment",
                "version": "2.2",
                "id": "lampstacbd61e316",
                "template_type": "Terraform",
                "template_content_type": "Amazon EC2",
                "template_provider": "Amazon EC2",
                "instance_name": "${input_parameters.inst_name}",
                "cloud_connection_name": "Amazon_IAM",
                "template_data_objects": {
                  "bastionhost": "DefaultNoBastionHostRequired"
                },
                "template_params": {
                  "aws_region": "us-east-1",
                  "aws_image": "ubuntu/images/hvm-ssd/ubuntu-xenial-16.04-amd64-server-*",
                  "aws_ami_owner_id": "099720109477",
                  "php_instance_name": "lampPhp",
                  "db_instance_name": "lampDb",
                  "network_name_prefix": "opencontent-lamp",
                  "public_key_name": "cam-public-key-lamp",
                  "public_key": "${input_parameters.public_key}",
                  "cam_user": "camuser",
                  "cam_pwd": "${input_parameters.cam_pwd}"
                },
                "outputs": []
              }
            },
            {
              "LAMP stack deployment on Microsoft Azure": {
                "title": "LAMP stack deployment on Microsoft Azure_bc6022",
                "template_name": "LAMP stack deployment on Microsoft Azure",
                "version": "2.2",
                "id": "lampstac86b071eb",
                "template_type": "Terraform",
                "template_content_type": "Microsoft Azure",
                "template_provider": "Microsoft Azure",
                "instance_name": "${input_parameters.inst_name}",
                "cloud_connection_name": "azure",
                "template_data_objects": {
                  "bastionhost": "DefaultNoBastionHostRequired"
                },
                "template_params": {
                  "azure_region": "West US",
                  "name_prefix": "${input_parameters.lamp_prefix}",
                  "admin_user": "ibmadmin",
                  "admin_user_password": "${input_parameters.admin_pwd}",
                  "user_public_key": "${input_parameters.public_key}"
                },
                "outputs": []
              }
            },
            {
              "Google Cloud LAMP stack deployment": {
                "title": "Google Cloud LAMP stack deployment_0c8552",
                "template_name": "Google Cloud LAMP stack deployment",
                "version": "2.2",
                "id": "googlecl6518f381",
                "template_type": "Terraform",
                "template_content_type": "Google Cloud",
                "template_provider": "Google Cloud",
                "instance_name": "${input_parameters.inst_name}",
                "cloud_connection_name": "google",
                "template_data_objects": {
                  "bastionhost": "DefaultNoBastionHostRequired"
                },
                "template_params": {
                  "boot_disk": "rhel-cloud/rhel-7",
                  "machine_type": "n1-standard-1",
                  "zone": "us-central1-a",
                  "mariadb_hostname": "think1_mdb_a",
                  "mariadb_user": "camuser",
                  "mariadb_pwd": "${input_parameters.mariadb_pwd}",
                  "php_hostname": "think1_php_a",
                  "gce_ssh_user": "camuser",
                  "gce_ssh_public_key": "${input_parameters.gce_ssh_pub_key}",
                  "gce_ssh_private_key": "${input_parameters.gce_ssh_pri_key}"
                },
                "outputs": [
                  "mariadb_IP",
                  "php_IP",
                  "test_url"
                ]
              }
            }
          ],
          "resthooks": [],
          "notifications": [
            {
              "emailnotification": {
                "title": "Success_Email",
                "type": "email",
                "receiverList": "${input_parameters.user_email}",
                "id": "emailnot56e37b29",
                "sender": "CAMadmin",
                "copyToList": "",
                "subject": "Your LAMP stack is ready",
                "body": "Your LAM Stack is deployed and you can access it here\nhttps://169.48.27.244:30000/cam/portal/!#/"
              }
            },
            {
              "emailnotification": {
                "title": "Error_email",
                "type": "email",
                "receiverList": "${input_parameters.user_email}",
                "id": "emailnot094bac45",
                "sender": "CAMadmin",
                "copyToList": "",
                "subject": "Your LAMP stack failed to deploy",
                "body": "Check into the failures here\n   \nhttps://169.48.27.244:30000/cam/portal/#!/serviceinstances"
              }
            }
          ],
          "sequence": {
            "0": "decision4441041f",
            "1": "emailnot56e37b29"
          },
          "error_sequence": {
            "0": "emailnot094bac45"
          }
        },
        "output_parameters": []
      }
    ],
    "plans": [
      {
        "name": "IBM Cloud",
        "description": "To Deploy a lamp stack to IBM Cloud",
        "actions": [],
        "plan_parameters": [
          {
            "name": "cloud",
            "label": "cloud",
            "customtype": "string",
            "type": "string",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": false,
            "description": "cloud to deploy to",
            "default": "IBM"
          },
          {
            "name": "aws_access_key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": false,
            "secured": false,
            "default": "^(dGVtcA==)"
          },
          {
            "name": "aws_secret_key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": false,
            "secured": false,
            "default": "^(dGVzdA==)"
          },
          {
            "name": "lamp_prefix",
            "label": "Lamp Stack name prefix",
            "customtype": "string",
            "type": "string",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": false,
            "description": "the prefix of the lamp stack instances (must be globally unique)",
            "default": "lamp2"
          },
          {
            "name": "gce_ssh_pub_key",
            "label": "Google SSH Pub Key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": true,
            "description": "public ssh key for Google cloud",
            "default": "^(XihaM05rWm1kelpHWm5abVJ6WjJaa2MyYz0p)"
          },
          {
            "name": "gce_ssh_pri_key",
            "label": "Google Private SSH Key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": true,
            "default": "^(XihjMlJtWjNObVpHZHpaR2M9KQ==)"
          }
        ]
      },
      {
        "name": "Amazon Cloud",
        "description": "To Deploy a lamp stack to Amazon Cloud",
        "plan_parameters": [
          {
            "name": "cloud",
            "label": "cloud",
            "customtype": "string",
            "type": "string",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": false,
            "description": "cloud to deploy to",
            "default": "AWS"
          },
          {
            "name": "aws_access_key",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": true,
            "default": "",
            "label": "AWS Access Key"
          },
          {
            "name": "aws_secret_key",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": true,
            "default": "",
            "label": "AWS Secret Key"
          },
          {
            "name": "gce_ssh_pri_key",
            "label": "Google Private SSH Key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": true,
            "default": "^(XihjMlJtWjNObVpHZHpaR2M9KQ==)"
          },
          {
            "name": "gce_ssh_pub_key",
            "label": "Google SSH Pub Key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": true,
            "description": "public ssh key for Google cloud",
            "default": "^(XihaM05rWm1kelpHWm5abVJ6WjJaa2MyYz0p)"
          }
        ]
      },
      {
        "name": "Microsoft Azure",
        "description": "To Deploy a lamp stack to Microsoft Azure",
        "plan_parameters": [
          {
            "name": "cloud",
            "label": "cloud",
            "customtype": "string",
            "type": "string",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": false,
            "description": "cloud to deploy to",
            "default": "Azure"
          },
          {
            "name": "aws_access_key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": false,
            "secured": false,
            "default": "^(dGVtcA==)"
          },
          {
            "name": "aws_secret_key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": false,
            "secured": false,
            "default": "^(dGVzdA==)"
          },
          {
            "name": "gce_ssh_pub_key",
            "label": "Google SSH Pub Key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": true,
            "description": "public ssh key for Google cloud",
            "default": "^(XihaM05rWm1kelpHWm5abVJ6WjJaa2MyYz0p)"
          },
          {
            "name": "gce_ssh_pri_key",
            "label": "Google Private SSH Key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": true,
            "default": "^(XihjMlJtWjNObVpHZHpaR2M9KQ==)"
          }
        ]
      },
      {
        "name": "Google Cloud",
        "description": "To Deploy a lamp stack to Google Cloud",
        "plan_parameters": [
          {
            "name": "cloud",
            "label": "cloud",
            "customtype": "string",
            "type": "string",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": false,
            "description": "cloud to deploy to",
            "default": "Google"
          },
          {
            "name": "aws_access_key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": false,
            "secured": false,
            "default": "^(dGVtcA==)"
          },
          {
            "name": "aws_secret_key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": false,
            "secured": false,
            "default": "^(dGVzdA==)"
          },
          {
            "name": "public_key",
            "label": "Public Key",
            "customtype": "password",
            "type": "password",
            "immutable": true,
            "hidden": true,
            "required": true,
            "secured": true,
            "description": "public key needed to connect to the vm post deployment",
            "default": "^(XihjM05vTFhKellTQkJRVUZCUWpOT2VtRkRNWGxqTWtWQlFVRkJSRUZSUVVKQlFVRkNRVkZETmxKd1RGcFNkV2x1WlhjclJUUkVXVTF6UjI5NGRuUXpWV2hSUW5sb1pXdHpjMk5xV1ZSbVIxTmthR2s1VG1adFZtbElWbVY0VFVOTlNsSndNbUp3SzBOUmVraGlObXRPUm1oRFJVUnFVVE5UTW5WT2EyOXFTRWRtTVhGV1puZHdiMUJXVEc1R04ydEVkREpxY1hwakswazNkR1Y0VXk5SlRuWjRXRWRHZDJrck1tbzRTSGxIYzJGeFJUWk5ZMVYyVGt0MlEwRldNeXMxT1hoVWNHZGtZUzlvUVc4MFRrMHZOamhKVW14QmQwWlFkekpuY1dOV2FWQmxWVWhZWmxWM2FYRlVjMDVoZFVkT2JGTkZORVZRV0U4eFQyRTVNalpOU1hjME9DdFhiM1JXVjB4a2NuTXZUMGRZY21oTlNWTTFhakZJUzJOWlVUY3JkMHBGTUhaT05FbFliRms1SzB0d2QwUktkRUpLUkhrNE1XMDNibXBTYVU1MlRWQndTMGxQVEV4d1NVY3ZkM0J6TVZsUGRrdHRPVkJSYlZKeFZXRlVWWEJhYjA5WVdXVkxjbEUyVEhCeEx6WXJTazlhYldkelEwZENWRm9nYVdaM1lYUjBjMEJqWVM1cFltMHVZMjl0UUdsaGJuTXRiV0p3TG5kaGNpNWpZVzR1YVdKdExtTnZiUT09KQ==)"
          }
        ]
      }
    ]
  }
}